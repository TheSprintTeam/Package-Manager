---
- name: Dynamic Playbook V0.1
  hosts: hosts
  become: false
  gather_facts: true

  vars:
    jsondata: "{{ lookup('file', 'payload.json') | from_json }}"
    technologies_to_install: "{{ jsondata.technologies }}"

  tasks:
    - name: Ping the hosts
      ping:

    - name: Print variable
      ansible.builtin.debug:
        var: jsondata

    - name: print technologies
      ansible.builtin.debug:
        var: item
      loop: "{{ technologies_to_install }}"
    
    # - name: Install Homebrew
    #   raw: "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    
    # - name: Install technologies on Darwin
    #   package:
    #     name: "{{ item }}"
    #     state: present
    #   loop: "{{ technologies_to_install }}"

    # - name: Print install status
    #   debug:
    #     msg: "Install status: {{ install_output }}"

    # - name: Uninstall technologies on Darwin
    #   package:
    #     name: "{{ item }}"
    #     state: absent
    #   loop: "{{ technologies_to_install }}"
    #   register: uninstall_output

    # - name: Print uninstall status
    #   debug:
    #     msg: "Uninstall status: {{ uninstall_output }}"

    # - name: Print install output
    #   debug:
    #     var: install_output.stdout_lines

    # - name: Print uninstall output
    #   debug:
    #     var: uninstall_output.stdout_lines